{% extends "console_base.html" %}

{% block extra_head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
{% endblock %}

{% block content %}
<div class="panel">
  <div class="grid cols-2">
    <div>
      <div><strong>Task ID:</strong> {{ task.id }}</div>
      <div><strong>Status:</strong> {{ task.status }}</div>
      <div><strong>Mission:</strong> {{ task.mission_id }}</div>
    </div>
    <div>
      <button id="export-btn" data-task-id="{{ task.id }}" data-token="{{ token }}">Export HTML</button>
      <div class="hint" id="export-result">No export yet.</div>
    </div>
  </div>
  <div id="map"></div>
</div>

<div class="panel">
  <h2>Observations</h2>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Item</th>
        <th>Severity</th>
        <th>Position</th>
        <th>Note</th>
      </tr>
    </thead>
    <tbody>
      {% for item in observations %}
      <tr>
        <td>{{ item.ts }}</td>
        <td>{{ item.item_code }}</td>
        <td>{{ item.severity }}</td>
        <td>{{ item.position_lat }}, {{ item.position_lon }}</td>
        <td>{{ item.note }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  window.__OBS = {{ observations_json | tojson }};
</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="/static/inspection_task.js"></script>
{% endblock %}
