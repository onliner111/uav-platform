{% extends "console_base.html" %}

{% block content %}
<div class="panel hero-panel">
  <div class="hero-head">
    <div>
      <h2>从职责进入，而不是从模块开始</h2>
      <p>把常用入口集中到角色工作台，降低学习成本，让非技术业务人员更容易上手。</p>
    </div>
    <div class="hero-actions">
      {% if featured_workbench %}
      <a class="button-link" href="{{ featured_workbench.href }}">进入{{ featured_workbench.label }}</a>
      {% endif %}
      {% if role_workbenches|length > 1 %}
      <a class="button-link ghost-link" href="{{ role_workbenches[1].href }}">切换到{{ role_workbenches[1].label }}</a>
      {% endif %}
    </div>
  </div>
</div>

<div class="cards ui-kpi-grid">
  <div class="card ui-kpi-card">
    <div>在线设备</div>
    <div class="value">{{ stats.online_devices }}</div>
  </div>
  <div class="card ui-kpi-card">
    <div>今日巡检</div>
    <div class="value">{{ stats.today_inspections }}</div>
  </div>
  <div class="card ui-kpi-card">
    <div>缺陷总数</div>
    <div class="value">{{ stats.defects_total }}</div>
  </div>
  <div class="card ui-kpi-card">
    <div>实时告警</div>
    <div class="value">{{ stats.realtime_alerts }}</div>
  </div>
</div>

<div class="panel">
  <div class="ui-section-head">
    <div>
      <h2>角色工作台</h2>
      <p class="ui-section-subtitle">系统会根据权限只显示和你职责相关的入口。</p>
    </div>
  </div>
  <div class="role-grid">
    {% for item in role_workbenches %}
    <a class="role-card" href="{{ item.href }}">
      <span class="status-pill">{{ item.badge }}</span>
      <h3>{{ item.label }}</h3>
      <p class="role-audience">{{ item.audience }}</p>
      <p>{{ item.summary }}</p>
      <div class="role-meta">
        <span>入口 {{ item.module_entries|length }} 个</span>
        <span>进入工作台</span>
      </div>
    </a>
    {% endfor %}
    {% if role_workbenches|length == 0 %}
    <div class="empty-note">
      当前账号还没有可用的角色工作台，请先在平台治理中补充读权限。
    </div>
    {% endif %}
  </div>
</div>

<div class="section-split">
  <div class="panel">
    <div class="ui-section-head">
      <div>
        <h2>今日待办</h2>
        <p class="ui-section-subtitle">围绕当前主角色给出最直接的下一步。</p>
      </div>
    </div>
    <div class="worklist">
      {% for item in next_steps %}
      <article class="worklist-item">
        <span class="worklist-icon">{{ loop.index }}</span>
        <div>
          <h3>{{ item.title }}</h3>
          <p>{{ item.detail }}</p>
        </div>
      </article>
      {% endfor %}
    </div>
  </div>

  <div class="panel">
    <div class="ui-section-head">
      <div>
        <h2>风险关注</h2>
        <p class="ui-section-subtitle">用更少的信息提醒当前班次优先级。</p>
      </div>
    </div>
    <div class="risk-grid">
      {% for item in attention_items %}
      <article class="risk-card {{ item.tone }}">
        <h3>{{ item.title }}</h3>
        <p>{{ item.detail }}</p>
      </article>
      {% endfor %}
    </div>
  </div>
</div>

<div class="panel">
  <div class="ui-section-head">
    <div>
      <h2>常用业务入口</h2>
      <p class="ui-section-subtitle">只保留高频业务模块，管理员专项工具单独归档在下方。</p>
    </div>
  </div>
  {% for group in module_entry_groups %}
  <section class="module-group">
    <div class="module-group-head">
      <h3>{{ group.label }}</h3>
      <p>{{ group.description }}</p>
    </div>
    <div class="module-grid">
      {% for item in group["items"] %}
      <a class="module-card" href="{{ item.href }}" data-nav-item data-nav-label="{{ item.label | lower }}" title="{{ item.description }}">
        <h4>{{ item.label }}</h4>
        <p>{{ item.description }}</p>
        <span class="module-cta">进入模块</span>
      </a>
      {% endfor %}
    </div>
  </section>
  {% endfor %}
</div>

{% if secondary_nav_groups %}
<div class="panel">
  <div class="ui-section-head">
    <div>
      <h2>管理员专项入口</h2>
      <p class="ui-section-subtitle">低频但必要的管理员工具统一归档，避免和日常业务入口混在一起。</p>
    </div>
  </div>
  {% for group in secondary_nav_groups %}
  <section class="module-group">
    <div class="module-group-head">
      <h3>{{ group.label }}</h3>
      <p>{{ group.description }}</p>
    </div>
    <div class="admin-link-grid">
      {% for item in group["items"] %}
      <a class="admin-link-card {% if item.active %}active{% endif %}" href="{{ item.href }}" data-nav-item data-nav-label="{{ item.label | lower }}">
        <span class="status-pill muted">专项</span>
        <span class="admin-link-title">{{ item.label }}</span>
        <span class="admin-link-desc">{{ item.description }}</span>
      </a>
      {% endfor %}
    </div>
  </section>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
