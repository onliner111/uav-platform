# Phase 40 - 真实无人机接入强化

## 0. Basis
- Based on: `项目最终目标.md`
- Depends on: `phases/phase-19-real-device-video-integration.md`

## 1. Objective
把现有“真实接入基线”从演示级提升到交付级，优先补强 MAVLink 实链路和 DJI 真 SDK 接入能力，形成稳定、可审计、可回退的真机控制与遥测链路。

## 2. Scope
- MAVLink 实链路固化（连接、心跳、遥测、命令、任务上传）
- DJI 真 SDK / 设备能力分层接入（替换当前仿真兜底）
- Fake / Sim / Real 三态切换与明确状态可视化
- 真机接入失败回退、重连与告警策略
- 真实设备接入验收脚本与最小现场联调手册

## 3. Out of Scope
- 全量厂商协议覆盖
- 多机大规模调度优化
- 机场（机巢）控制链路

## 4. Deliverables
- 真机接入增强后的适配器实现
- 真机运行状态与错误诊断视图
- 真机联调 / 回退操作手册
- 可复跑的真机接入验收脚本（允许 Sim/Real 双路径）

## 5. Acceptance
- MAVLink 真实链路可在非仿真模式下稳定上报遥测并执行最小命令
- DJI 不再只停留在仿真占位，至少形成真实 SDK 接入最小闭环
- Fake / Sim / Real 三态切换不破坏既有业务流程
- 真机接入失败可明确诊断、告警并回退

## 6. Product Delivery Standard
- 本阶段触达的接入配置、状态展示和诊断页面，必须继续满足“正式交付给非技术业务人员长期使用”的标准，不能把真实接入能力做成仅工程师可读的调试台
- 所有 UI 变更必须保持或优于 Phase 32 的产品化基线：中文化、统一壳层、统一状态反馈、管理员技术能力下沉
- 面向业务用户默认只展示“当前模式 / 当前风险 / 下一步动作”，底层连接参数、协议细节和调试输出必须下沉到管理员技术区
- 真机能力未就绪时，必须明确显示“仿真 / 模拟 / 真实”状态，不能让用户误判当前是否已经接入真实设备

## 7. Exit Criteria
- `ruff`, `mypy`, `pytest`, `e2e` 全绿
- 真机接入最小链路在 Sim / Real 路径下均可复验
- 本阶段触达的页面保持或优于 Phase 32 的产品化效果
- 真机联调手册与演示脚本可复跑

---

## 8. Priority Tuning (P0/P1/P2)

- P0：
  - `40-WP1` MAVLink 实链路固化
  - `40-WP2` DJI 真 SDK 最小闭环
- P1：
  - `40-WP3` 三态切换、回退与接入诊断
  - `40-WP4` 接入状态 UI 与管理员诊断视图
- P2：
  - `40-WP5` 真机联调脚本与交付手册优化
- 执行顺序：`P0 -> P1 -> P2 -> 40-WP6`

## 9. Execution Progress

- [ ] 40-WP1 MAVLink 实链路固化
- [ ] 40-WP2 DJI 真 SDK 最小闭环
- [ ] 40-WP3 三态切换、回退与接入诊断
- [ ] 40-WP4 接入状态 UI 与管理员诊断视图
- [ ] 40-WP5 真机联调脚本与交付手册优化
- [ ] 40-WP6 验收关账
