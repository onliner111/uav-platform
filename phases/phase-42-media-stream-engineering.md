# Phase 42 - 视频链路工程化

## 0. Basis
- Based on: `项目最终目标.md`
- Depends on: `phases/phase-19-real-device-video-integration.md`
- Depends on: `phases/phase-40-real-uav-integration-hardening.md`

## 1. Objective
把现有视频接入抽象从“可演示”提升到“可稳定交付”，形成可观测、可降级、可排障的 RTSP / WebRTC 视频链路工程化基础。

## 2. Scope
- 视频流接入稳定性增强（健康检查、自动重试、状态机）
- 多路视频槽位的统一管理与前台展示优化
- RTSP / WebRTC 接入策略与降级路径
- 视频链路状态诊断、告警与回放线索
- 媒体接入验收脚本与现场网络排障手册

## 3. Out of Scope
- 独立媒体中台建设
- 大规模转码集群与 CDN 分发
- AI 视频分析大模型重构

## 4. Deliverables
- 视频链路状态机与健康诊断增强
- 指挥中心视频区域的交付级产品化增强
- 视频接入与降级策略操作手册
- 可复跑的媒体接入验收脚本

## 5. Acceptance
- 视频流接入可稳定显示状态，不因短时抖动直接失控
- 指挥中心可清晰区分“在线 / 异常 / 降级 / 无流”
- RTSP / WebRTC 路径和降级策略有明确口径
- 现场运维可根据诊断信息快速判断问题在设备、网络还是平台侧

## 6. Product Delivery Standard
- 视频相关 UI 必须继续保持正式交付标准，主路径面向非技术业务用户，只展示状态、风险和处理建议
- 底层媒体参数、协议细节和排障信息必须下沉到管理员技术区，不能污染主业务视图
- 指挥中心等高频页面的任何改动，都必须保持或优于 Phase 33 与 Phase 32 的产品化效果，不得因视频工程化回退到技术演示页
- 对不可用或降级状态必须给出清晰中文提示，不能只显示空窗口或技术错误码

## 7. Exit Criteria
- `ruff`, `mypy`, `pytest`, `e2e` 全绿
- 视频接入 / 降级 / 恢复最小闭环可复验
- 指挥中心等触达页面保持或优于既有产品化效果
- 媒体接入演示脚本与排障手册可复跑

---

## 8. Priority Tuning (P0/P1/P2)

- P0：
  - `42-WP1` 视频状态机与健康诊断增强
  - `42-WP2` 指挥中心视频槽位交付级增强
- P1：
  - `42-WP3` RTSP / WebRTC 降级与恢复路径
  - `42-WP4` 视频链路告警与管理员诊断视图
- P2：
  - `42-WP5` 媒体接入验收脚本与排障手册优化
- 执行顺序：`P0 -> P1 -> P2 -> 42-WP6`

## 9. Execution Progress

- [ ] 42-WP1 视频状态机与健康诊断增强
- [ ] 42-WP2 指挥中心视频槽位交付级增强
- [ ] 42-WP3 RTSP / WebRTC 降级与恢复路径
- [ ] 42-WP4 视频链路告警与管理员诊断视图
- [ ] 42-WP5 媒体接入验收脚本与排障手册优化
- [ ] 42-WP6 验收关账
