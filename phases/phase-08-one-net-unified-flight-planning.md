# Phase 08+ Master Planning - One-Net Unified Flight

## 0. Header
- Title: One-Net Unified Flight Stage Planning
- Based on: `项目最终目标.md`
- Planning status: Planned (not started)
- Scope type: Product-stage planning only (no code execution in this document)

## 1. Planning Goal
Build a "一网统飞" platform in staged increments:
- One network for full-domain air operation visibility
- One unified workflow for mission lifecycle and closed-loop handling
- One governance baseline for tenant isolation, RBAC, and audit traceability

## 2. Constraints (Inherited)
- Keep monolith + plugin adapter architecture
- Keep docker-compose-driven delivery and quality gates
- No LLM real-time flight control logic
- Tenant boundary and audit requirements remain hard constraints

## 3. Capability Mapping (A-J -> Phases)
- A 组织与权限 -> Phase 08
- B 设备与飞行资源管理 -> Phase 09
- C 地图态势（一张图） -> Phase 10
- D 任务中心（一套流程） -> Phase 11
- E 空域与合规 -> Phase 12
- F 数据与成果 -> Phase 13
- G 告警与处置闭环 -> Phase 13
- H AI 能力（非实时控制） -> Phase 14
- I 统计与考核 -> Phase 15
- J 开放平台（插件/外部系统） -> Phase 15

## 4. Stage Plan

### Phase 08: Org/RBAC v2 and Data Perimeter
Objective:
- Complete multi-org hierarchy and data permission model (org/project/area/task).

Scope:
- Organization tree model and APIs
- Role template + custom role policy
- Data-permission filters for key domains
- Audit coverage reinforcement for critical operations

Acceptance:
- Cross-org and cross-tenant access policy tests pass
- Admin/operator/auditor permissions are demonstrable in UI/API
- Critical actions are fully traceable in audit logs

Exit criteria:
- Governance matrix updated
- Quality gate green (`ruff`, `mypy`, `pytest`, `e2e`)

### Phase 09: Flight Resource and Asset Management
Objective:
- Manage UAV, payload, battery, controller, dock, and maintenances as first-class resources.

Scope:
- Asset lifecycle (register, bind, retire)
- Health and availability model
- Maintenance work orders and history
- Regional resource pool query

Acceptance:
- Resource pool can answer "what can fly where now"
- Asset maintenance and fault history are queryable
- API and UI demo flow passes

Exit criteria:
- Data model migration + regression tests complete

### Phase 10: Unified Map Situation v1
Objective:
- Deliver operational "one map" view for command and daily operation.

Scope:
- 2D map with multi-layer overlays
- Realtime + historical track playback
- Event/task/resource overlays
- Video slot integration abstraction (RTSP/WebRTC ready)

Acceptance:
- Command dashboard shows live status + tracks + key overlays
- Playback and layer switching are stable in demo

Exit criteria:
- WebSocket and map interaction regression tests in place

### Phase 11: Unified Task Center Workflow
Objective:
- Standardize mission workflow across patrol/emergency/survey/security/custom.

Scope:
- Mission type taxonomy and template center
- Dispatch mode: manual + rule/score based auto-match
- Lifecycle: create -> approve(optional) -> execute -> accept -> archive
- Task dossier: area, risks, checklist, attachments

Acceptance:
- End-to-end multi-role workflow runnable
- Task lifecycle and ownership are fully auditable

Exit criteria:
- Workflow state-machine tests and e2e scripts pass

### Phase 12: Airspace Compliance and Safety Rails
Objective:
- Add airspace and safety controls as platform-level policy rails.

Scope:
- No-fly/height/sensitive zone layers and checks
- Preflight checklist and approval policies
- Geofence policy enforcement
- Command traceability hardening

Acceptance:
- Illegal mission plan is blocked with explicit reason
- Emergency fast-lane remains controlled and auditable

Exit criteria:
- Compliance scenarios covered by automated tests

### Phase 13: Data Outcomes and Alert Closure Chain
Objective:
- Build unified data repository and alert handling closed-loop.

Scope:
- Raw data + outcome data catalog
- Structured result fields and status model
- Alert levels (P1/P2/P3) + duty routing
- Closure workflow: alert -> action -> verification -> review
- Report export (PDF/Word) enhancement

Acceptance:
- Alert lifecycle and data lineage are traceable end-to-end
- Outcome reports can be generated by task/time window

Exit criteria:
- Export and closure e2e verification passes

### Phase 14: AI Assistant and Evidence Chain
Objective:
- Introduce non-realtime AI assistance with strict traceability.

Scope:
- Offline/near-realtime analysis pipeline
- Mission summary and dispatch suggestion generation
- Model/version/threshold/input-hash evidence chain
- Human-in-the-loop review and override

Acceptance:
- AI outputs are explainable and auditable
- No AI component directly controls realtime flight operations

Exit criteria:
- Evidence-chain integrity checks pass in tests

### Phase 15: Assessment KPIs and Open Platform
Objective:
- Complete management KPIs and open integration capability.

Scope:
- KPI center: duration, mileage, completion, closure SLA, utilization
- Heatmaps and comparative analytics
- Open integration: adapters/webhook/external work-order systems
- API governance and partner integration guide

Acceptance:
- Monthly/quarterly governance report generation is one-click
- External system integration demo passes via stable interface contract

Exit criteria:
- KPI and integration regression suite established

## 5. Milestone Grouping
- M2 (08-10): Foundation for org/resource/map
- M3 (11-13): Workflow/compliance/closure operationalization
- M4 (14-15): AI-assist + KPI + open-platform commercialization readiness

## 6. Suggested Execution Order
1. Phase 08
2. Phase 09
3. Phase 10
4. Phase 11
5. Phase 12
6. Phase 13
7. Phase 14
8. Phase 15

## 7. Governance and Reporting Requirements per Phase
- Update `phases/state.md` on phase state changes
- Sync `docs/PROJECT_STATUS.md` after state update
- Generate `logs/<phase-name>.report.md` for each phase completion/failure
- Keep `governance/tenant_boundary_matrix.md` and phase acceptance evidence synchronized

## 8. Definition of Planning Done
- Stage breakdown is aligned with `项目最终目标.md` A-J capability map
- Each stage has objective/scope/acceptance/exit criteria
- Milestone grouping and execution order are explicit
