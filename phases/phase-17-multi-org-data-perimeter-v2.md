# Phase 17 - 多组织与数据权限 2.0

## 0. Basis
- Depends on: `phases/phase-16-saas-console-ui.md`

## 1. Objective
在租户内建立多组织协作与细粒度数据域权限体系，确保“可协作、可隔离、可审计”。
仅平台超级管理员具备跨租户治理能力，且跨租户操作必须全量审计。

## 2. Scope
- 组织树（组织/部门）与成员岗位关系
- 组织维度角色授权与继承策略
- 数据域权限（区域/任务/资源级）策略增强
- 平台超级管理员跨租户治理入口
- 权限变更审计字段标准化
- 跨租户访问语义延续既有约束：非平台超管请求保持 `404` 语义

## 3. Out of Scope
- 复杂 ABAC 规则引擎
- 跨平台统一 IAM 中台对接

## 4. Deliverables
- 组织与岗位模型增强及 API
- 数据权限策略与判定入口增强
- 平台超管治理 API 与页面入口
- 跨部门/跨租户边界回归测试

## 5. Acceptance
- 最小权限矩阵回归通过：同部门允许、跨部门按策略允许/拒绝、跨租户请求返回 `404`
- 区域/任务/资源权限组合生效且判定顺序固定：`explicit_deny > explicit_allow > inherited_allow > default_deny`
- 平台超管跨租户治理接口可用，且租户管理员/普通角色无法调用
- 权限变更审计记录完整，至少包含 `who/when/where/what/result` 与 `tenant/org/scope` 信息

## 6. Exit Criteria
- `ruff`, `mypy`, `pytest`, `e2e` 全绿
- 权限矩阵回归与边界测试全绿

---

## 7. Priority Tuning (P0/P1/P2)

- P0（先做，阻塞后续治理能力）：
  - `17-WP1` 组织树与成员岗位模型
  - `17-WP2` 数据域权限最小闭环（区域/任务/资源）
- P1（随后完成，形成可运营权限体系）：
  - `17-WP3` 平台超级管理员能力 + 权限变更审计与追踪增强
- P2（可延后到本阶段后半）：
  - 在 `17-WP3` 基础上增强高级继承与冲突解析策略
- 执行顺序：`P0 -> P1 -> P2 -> 17-WP4`

## 8. Execution Progress

- [x] 17-WP1 组织树与成员岗位模型
- [x] 17-WP2 数据域权限闭环
- [x] 17-WP3 平台超管与审计增强
- [x] 17-WP4 验收关账
