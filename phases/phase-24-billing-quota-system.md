# Phase 24 - 计费与配额系统

## 0. Basis
- Based on: `111.md`
- Depends on: `phases/phase-23-ai-model-governance-v2.md`

## 1. Objective
建立可商用 SaaS 所需的套餐、配额、计量与账单能力，支撑商业化交付。

## 2. Scope
- 套餐与订阅管理
- 配额限制（用户/设备/任务/存储）
- 用量采集与计量聚合
- 账单生成与账期结算基础能力
- 配额命中审计与告警联动

## 3. Out of Scope
- 完整支付网关与发票系统
- 复杂多币种结算

## 4. Deliverables
- 套餐、订阅、配额、用量域模型与 API
- 计量管道与账单生成任务
- 配额拦截与超限提示机制
- 商业化计量一致性回归测试

## 5. Acceptance
- 可按套餐与配额限制系统使用
- 用量统计与账单结果可追溯
- 配额超限可实时拦截并留痕
- 跨租户账务数据隔离稳定

## 6. Exit Criteria
- `ruff`, `mypy`, `pytest`, `e2e` 全绿
- 计费与配额演示脚本可复跑

---

## 7. Priority Tuning (P0/P1/P2)

- P0（先做，阻塞商业化）：
  - `24-WP1` 套餐/订阅/配额最小闭环
  - `24-WP2` 用量采集与配额拦截最小链路
- P1（随后完成，形成可计费能力）：
  - `24-WP3` 账单生成与账期汇总
  - `24-WP3` 超限告警与审计增强
- P2（可延后到本阶段后半）：
  - `24-WP2` 精细化计量口径与成本分摊优化
- 执行顺序：`P0 -> P1 -> P2 -> 24-WP4`

## 8. Execution Progress

- [ ] 24-WP1 套餐订阅与配额最小闭环
- [ ] 24-WP2 用量采集与配额拦截
- [ ] 24-WP3 账单生成与治理增强
- [ ] 24-WP4 验收关账

