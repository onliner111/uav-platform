# Phase 41 - 机巢与机场联动控制

## 0. Basis
- Based on: `项目最终目标.md`
- Depends on: `phases/phase-09-flight-resource-asset-management.md`
- Depends on: `phases/phase-40-real-uav-integration-hardening.md`

## 1. Objective
把现有“机巢/机场”从资产台账对象升级为可联动、可监控、可留痕的现场设施，形成起降准备、状态同步、异常告警和人工接管的最小控制闭环。

## 2. Scope
- 机巢 / 机场设施状态模型（舱门、电源、充电、在线、占用）
- 最小控制动作（开仓、关仓、起飞准备、回收准备、人工接管）
- 机场 / 机巢与任务、设备、告警联动
- 机巢设施异常告警、恢复建议和审计留痕
- 机场 / 机巢现场联调与交付验收脚本

## 3. Out of Scope
- 全自动无人值守机场全流程编排
- 多品牌机巢协议全面覆盖
- 大规模机场调度网络

## 4. Deliverables
- 机巢 / 机场控制域模型与接口
- 设施状态与告警联动链路
- 机巢 / 机场管理员操作页或管理员区增强
- 现场联调 / 异常回退操作手册

## 5. Acceptance
- 机巢 / 机场不再只是台账，可完成最小控制动作并留痕
- 设施状态可与任务、告警和态势页联动展示
- 设施异常可被识别、告警并给出明确下一步动作
- 人工接管路径清晰，不因自动联动导致失控

## 6. Product Delivery Standard
- 面向业务用户的主路径必须以“设施状态 + 可执行动作 + 风险提示”为核心，不能暴露原始协议指令、底层寄存器或设备调试字段
- 如需展示专业设备信息，必须下沉到管理员技术区，且保持中文化与统一组件风格
- 触达的任务、态势、资产或告警页面必须继续保持或优于 Phase 32 的产品化效果，不得因设施联动重新引入工程化交互
- 设施控制动作必须强调确认、结果反馈和人工回退，避免把现场高风险动作做成隐蔽快捷键

## 7. Exit Criteria
- `ruff`, `mypy`, `pytest`, `e2e` 全绿
- 机巢 / 机场最小控制闭环可复验
- 本阶段触达页面保持或优于 Phase 32 的产品化效果
- 现场联调与人工接管手册可复跑

---

## 8. Priority Tuning (P0/P1/P2)

- P0：
  - `41-WP1` 机巢 / 机场状态模型与最小控制动作
  - `41-WP2` 设施状态与任务 / 告警联动
- P1：
  - `41-WP3` 设施异常告警与人工接管路径
  - `41-WP4` 管理员控制页与留痕优化
- P2：
  - `41-WP5` 现场联调脚本与交付手册优化
- 执行顺序：`P0 -> P1 -> P2 -> 41-WP6`

## 9. Execution Progress

- [ ] 41-WP1 机巢 / 机场状态模型与最小控制动作
- [ ] 41-WP2 设施状态与任务 / 告警联动
- [ ] 41-WP3 设施异常告警与人工接管路径
- [ ] 41-WP4 管理员控制页与留痕优化
- [ ] 41-WP5 现场联调脚本与交付手册优化
- [ ] 41-WP6 验收关账
